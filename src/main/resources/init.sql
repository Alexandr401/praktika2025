-- удаление таблиц
-- DROP TABLE IF EXISTS painting_exhibition, paintings, exhibitions, artists, users CASCADE;

-- Таблицы
-- пользователи
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(200) NOT NULL,
    role VARCHAR(20) NOT NULL CHECK (role IN ('admin', 'user'))
);

-- художники
CREATE TABLE artists (
    id SERIAL PRIMARY KEY,
    full_name VARCHAR(150) NOT NULL,
    image VARCHAR(200),
    birth_date DATE,
    death_date DATE,  -- NULL = жив
    biography TEXT
);

-- картины
CREATE TABLE paintings (
    id SERIAL PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    genre VARCHAR(100),
    image VARCHAR(200),
    year INT,
    artist_id INT NOT NULL REFERENCES artists(id) ON DELETE CASCADE,
    description TEXT
);

-- выставки
CREATE TABLE exhibitions (
    id SERIAL PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,
    location VARCHAR(200),
    description TEXT
);

-- связь картин и выставок
CREATE TABLE painting_exhibition (
    id SERIAL PRIMARY KEY,
    painting_id INT NOT NULL REFERENCES paintings(id) ON DELETE CASCADE,
    exhibition_id INT NOT NULL REFERENCES exhibitions(id) ON DELETE CASCADE,
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,

    CHECK (start_date <= end_date)
);

CREATE EXTENSION IF NOT EXISTS btree_gist;

-- ограничение пересечений дат
ALTER TABLE painting_exhibition
    ADD CONSTRAINT no_overlap
        EXCLUDE USING gist (
        painting_id WITH =,
        daterange(start_date, end_date, '[]') WITH &&
        );

-- Очистка таблиц
-- TRUNCATE TABLE painting_exhibition, paintings, exhibitions, artists, users RESTART IDENTITY CASCADE;

-- Данные
-- художники
INSERT INTO artists (full_name, image, birth_date, death_date, biography) VALUES
    ('Леонардо да Винчи','Leonardo_da_Vinci.jpg','1452-04-15','1519-05-02','Итальянский художник, ученый и изобретатель эпохи Возрождения. Один из величайших гениев в истории человечества, автор «Моны Лизы» и «Тайной вечери».'),
    ('Винсент ван Гог','Vincent_van_Gogh.jpg','1853-03-30','1890-07-29','Нидерландский художник-постимпрессионист. При жизни был малоизвестен, но оказал огромное влияние на искусство XX века.'),
    ('Пабло Пикассо','Pablo_Picasso.jpg','1881-10-25','1973-04-08','Испанский и французский художник, один из основателей кубизма. Создал более 20 тысяч произведений искусства.'),
    ('Клод Моне','Claude_Monet.jpg','1840-11-14','1926-12-05','Французский художник, один из основателей импрессионизма. Известен сериями картин с кувшинками и Руанским собором.'),
    ('Сальвадор Дали','Salvador_Dali.jpg','1904-05-11','1989-01-23','Испанский художник-сюрреалист, известный эпатажным поведением и фантастическими образами, такими как «Постоянство памяти».'),
    ('Илья Репин','Ilya_Repin.jpg','1844-08-05','1930-09-29','Русский художник-реалист, мастер портрета и исторической живописи, представитель Товарищества передвижников.'),
    ('Иван Айвазовский','Ivan_Aivazovsky.jpg','1817-07-29','1900-05-05','Русский живописец-маринист армянского происхождения. Создал более 6000 картин, преимущественно морских пейзажей.'),
    ('Казимир Малевич','Kazimir_Malevich.jpg','1879-02-23','1935-05-15','Русский и советский художник-авангардист, основатель супрематизма, автор картины «Чёрный квадрат».'),
    ('Герхард Рихтер','Gerhard_Richter.jpg','1932-02-09',NULL,'Немецкий современный художник, работающий в жанрах фотореализма и абстракции. Один из самых дорогих ныне живущих художников.'),
    ('Бэнкси',NULL,'1974-01-01',NULL,'Анонимный уличный художник из Великобритании, известный политическими граффити и социальной сатирой.');


--  картины
INSERT INTO paintings (title, genre, image, year, artist_id, description) VALUES
    -- Леонардо да Винчи
    ('Мона Лиза', 'Портрет', 'mona_lisa.png', 1503, 1, 'Знаменитый портрет Лизы Герардини'),
    ('Дама с горностаем', 'Портрет', 'lady_ermine.jpeg', 1490, 1, 'Портрет Чечилии Галлерани'),
    ('Тайная вечеря', 'Религиозная живопись', 'last_supper_high_resolution.jpg', 1498, 1, 'Сцена последней трапезы Христа с учениками'),

    -- Винсент ван Гог
    ('Звёздная ночь', 'Пейзаж', 'starry_night.jpeg', 1889, 2, 'Ночной пейзаж с вихревым небом'),
    ('Подсолнухи', 'Натюрморт', 'sunflowers.jpeg', 1888, 2, 'Серия натюрмортов с подсолнухами'),
    ('Спальня в Арле', 'Интерьер', 'slaapkamer_arles.jpg', 1888, 2, 'Комната художника в Арле'),

    -- Пабло Пикассо
    ('Герника', 'Историческая живопись', 'picassoGuernica.jpg', 1937, 3, 'Антивоенное полотно о бомбардировке Герники'),
    ('Авиньонские девицы', 'Портрет', 'desmoiselles_Avignon.jpg', 1907, 3, 'Групповой портрет в новаторской манере'),
    ('Женщина с мандолиной', 'Кубизм', 'girl_mandolin.jpg', 1910, 3, 'Классический пример аналитического кубизма'),

    -- Клод Моне
    ('Впечатление. Восход солнца', 'Пейзаж', 'claude_monet.jpg', 1872, 4, 'Картина, давшая название импрессионизму'),
    ('Кувшинки', 'Пейзаж', 'water_lilies.jpg', 1916, 4, 'Серия картин с водяными лилиями'),
    ('Женщина с зонтиком', 'Портрет', 'woman_parasol.jpg', 1875, 4, 'Портрет на фоне пейзажа'),

    -- Сальвадор Дали
    ('Постоянство памяти', 'Сюрреализм', 'persistence_memory.jpg', 1931, 5, 'Знаменитые тающие часы'),
    ('Сон, вызванный полётом пчелы', 'Сюрреализм', 'flight_bumblebee_around.jpg', 1944, 5, 'Фантастический образ сна'),
    ('Портрет Галы', 'Портрет', 'galarina.jpg', 1935, 5, 'Портрет жены и музы художника'),

    -- Илья Репин
    ('Бурлаки на Волге', 'Реализм', 'barge_volga.jpg', 1873, 6, 'Изображение тяжёлого крестьянского труда'),
    ('Не ждали', 'Реализм', 'unexpected_visitors.jpg', 1888, 6, 'Возвращение ссыльного в семью'),
    ('Портрет Мусоргского', 'Портрет', 'modest_musorgski.jpg', 1881, 6, 'Портрет композитора в последние дни жизни'),

    -- Иван Айвазовский
    ('Девятый вал', 'Пейзаж', 'ninth_wave.jpg', 1850, 7, 'Борьба человека со стихией моря'),
    ('Чёрное море', 'Пейзаж', 'black_sea.jpg', 1881, 7, 'Морской пейзаж в сдержанных тонах');

-- выставки
INSERT INTO exhibitions (name, start_date, end_date, location, description) VALUES
    ('Шедевры Ренессанса', '2025-01-10', '2025-03-15', 'Лувр, Париж', 'Лучшие произведения эпохи Возрождения'),
    ('Импрессионизм и свет', '2025-04-01', '2025-06-01', 'Музей Орсе, Париж', 'Развитие импрессионизма'),
    ('Искусство XX века', '2025-05-10', '2025-08-10', 'Тейт Модерн, Лондон', 'Главные направления XX века'),
    ('Русская живопись', '2025-02-01', '2025-04-30', 'Третьяковская галерея, Москва', 'Классика русского искусства'),
    ('Сюрреализм и подсознание', '2025-06-15', '2025-09-01', 'Музей Дали, Фигерас', 'Мир снов и фантазий'),
    ('Современное искусство улиц', '2025-07-01', '2025-10-01', 'Берлинская галерея', 'Стрит-арт и современность');

-- связь картин и выставок
INSERT INTO painting_exhibition (painting_id, exhibition_id, start_date, end_date) VALUES
    (1, 1, '2025-01-10', '2025-03-15'),
    (2, 1, '2025-01-10', '2025-03-15'),

    (7, 2, '2025-04-01', '2025-06-01'),
    (8, 2, '2025-04-01', '2025-06-01'),

    (5, 3, '2025-05-10', '2025-08-10'),
    (6, 3, '2025-05-10', '2025-08-10'),
    (14, 3, '2025-05-10', '2025-08-10'),

    (11, 4, '2025-02-01', '2025-04-30'),
    (12, 4, '2025-02-01', '2025-04-30'),
    (13, 4, '2025-02-01', '2025-04-30'),

    (9, 5, '2025-06-15', '2025-09-01'),
    (10, 5, '2025-06-15', '2025-09-01'),

    (15, 6, '2025-07-01', '2025-10-01');
